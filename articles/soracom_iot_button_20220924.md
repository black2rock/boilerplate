---
title: "ãƒŸãƒ«ã‚¯ã®æ‰“åˆ»ã«IoTã‚’å°Žå…¥ã—ã¦ã¿ãŸ" # è¨˜äº‹ã®ã‚¿ã‚¤ãƒˆãƒ«
emoji: "ðŸ‘¶" # ã‚¢ã‚¤ã‚­ãƒ£ãƒƒãƒã¨ã—ã¦ä½¿ã‚ã‚Œã‚‹çµµæ–‡å­—ï¼ˆ1æ–‡å­—ã ã‘ï¼‰
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢è¨˜äº‹
topics: ["AWS","IoT","soracom","ãƒ™ãƒ“ãƒ¼ãƒ†ãƒƒã‚¯"] # ã‚¿ã‚°ã€‚["markdown", "rust", "aws"]ã®ã‚ˆã†ã«æŒ‡å®šã™ã‚‹
published: true # å…¬é–‹è¨­å®šï¼ˆfalseã«ã™ã‚‹ã¨ä¸‹æ›¸ãï¼‰
published_at: 2022-09-24
---

ç¾åœ¨è‚²å…ä¼‘è·ã‚’å–å¾—ã—ã¦ã„ã¾ã™ã€‚æ±äº¬éƒ½ã§ã¯[ã€Œè‚²æ¥­ã€](https://www.metro.tokyo.lg.jp/tosei/hodohappyo/press/2022/06/29/09.html)ã¨ã„ã†æ„›ç§°ã§æ±ºå®šã—ãŸã‚ˆã†ã§ã™ãŒã€ãã®åã®é€šã‚Šä¼‘ã‚“ã§ã„ã‚‹æš‡ãªã©ãªãã€å­ä¾›ã®è¦æœ›ã«å¿œãˆç¶šã‘ã¦ã„ãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚æœ¬è¨˜äº‹ã§ã¯ã€å­ã©ã‚‚ãŒãƒŸãƒ«ã‚¯ã‚’é£²ã‚“ã æ™‚åˆ»ã‚’LINEã«é€šçŸ¥ã•ã›ã‚‹ä»•çµ„ã¿ã‚’SORACOM IoTãƒœã‚¿ãƒ³ã‚’ä½¿ã£ã¦å®Ÿç¾ã—ãŸæ–¹æ³•ã‚’è¨˜è¼‰ã—ã¾ã™ã€‚

### æœ¬å–çµ„ã¿ã®ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³
å­ã©ã‚‚ãŒï¼“ã€œï¼”æ™‚é–“ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«ã§ãƒŸãƒ«ã‚¯ã‚’é£²ã‚€ã“ã¨ãŒçµŒé¨“å‰‡ã¨ã—ã¦ã‚ã‹ã£ã¦ãã¦ã„ãŸã®ã§ã€æ‰“åˆ»ã•ãˆã§ãã‚Œã°æ¬¡ã®ãƒŸãƒ«ã‚¯ã®ãŠãŠã‚ˆãã®æ™‚é–“ãŒã‚ã‹ãƒªã¾ã™ã€‚å­ä¾›ãŒæ³£ã„ã¦ã‹ã‚‰å¯¾å¿œã™ã‚‹ã¨ã„ã†å—å‹•çš„ãªè‚²å…ã§ã¯ãªãã€ã€Œãã‚ãã‚ãŠè…¹ãŒç©ºãã¯ãšã ã€ãƒŸãƒ«ã‚¯ã®æº–å‚™ã‚’ã—ã¦ãŠã“ã†ã€ã¨ã„ã†èƒ½å‹•çš„ãªè‚²å…ã‚’ITã®åŠ›ã§å®Ÿç¾ã§ããªã„ã‹ã€ã¨æ€ã„ç«‹ã£ãŸã®ãŒãã£ã‹ã‘ã§ã™ã€‚ 

ã¾ãŸã€å¤œä¸­ã®ãƒŸãƒ«ã‚¯æ‹…å½“ã¯ä¸¡è¦ªã®ã©ã¡ã‚‰ã‹ãŒæ‹…å½“ã™ã‚‹ã“ã¨ãŒå¤šã„ã¨æ€ã„ã¾ã™ã€‚ãã®ã‚ˆã†ãªå½¹å‰²åˆ†æ‹…ã®å ´åˆã€å¤œä¸­ã®ä½•æ™‚ã«ãƒŸãƒ«ã‚¯ã‚’é£²ã‚“ã ã®ã‹ã¯ã€å¯ã¦ã„ãŸæ–¹ã®è¦ªã¯ã‚‚ã¡ã‚ã‚“ã‚ã‹ã‚Šã¾ã›ã‚“ã€‚ã€Œä½•æ™‚ã«é£²ã‚“ã ã®ï¼Ÿä»Šå­ã©ã‚‚ã¯ãŠè…¹ç©ºã„ã¦ã‚‹ï¼Ÿã€ã¨å¤œä¸­å¯¾å¿œã—ã¦ã„ãŸè¦ªã‚’å©ãèµ·ã“ã—ã¦èžãã¾ã§ã‚‚ãªãã€LINEã®ç”»é¢ã‚’è¦‹ã‚Œã°ä¸€ç›®çž­ç„¶ã«ãªã‚‹ã€ã¨ã„ã†ã®ã‚‚å‰¯æ¬¡çš„ãªåŠ¹æžœã¨ã—ã¦ã‚ã‚‹ã®ã§ã¯ï¼Ÿã¨æ€ã„é–‹ç™ºã«è‡³ã‚Šã¾ã—ãŸã€‚

### ãªãœIoTï¼Ÿ
IoTã‚’ä½¿ã‚ãšã¨ã‚‚æ‰“åˆ»ã ã‘ã§ã‚ã‚Œã°ç›´æŽ¥LINEã«æ–‡è¨€ã‚„ã‚¹ã‚¿ãƒ³ãƒ—ç­‰ã‚’æŠ•ç¨¿ã™ã‚Œã°è‰¯ã„ã®ã§ã¯ï¼Ÿã¨æ€ã‚ã‚Œã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€å¤œä¸­ã®ãƒŸãƒ«ã‚¯å¾Œã®2æ™‚ã‚„3æ™‚ã«ã‚¹ãƒžãƒ›ã‹ã‚‰LINEã‚’é–‹ã„ã¦æŠ•ç¨¿ã™ã‚‹ã¨ã„ã†ã®ã¯ã€ã‚¹ãƒžãƒ›ã®ãƒ–ãƒ«ãƒ¼ãƒ©ã‚¤ãƒˆã‚’æµ´ã³ã‚‹ã¨ã„ã†ç‚¹ã‚„æ‰‹æ•°ï¼ˆã‚¹ãƒžãƒ›é–‹ãâ†’LINEé–‹ãâ†’æŠ•ç¨¿ï¼‰ã‹ã‚‰ã‚‚å®Ÿæ–½ã—ãŸããªã„ã€ã¨ã„ã†ã®ãŒå€‹äººçš„ãªæ€ã„ã¨ã—ã¦ã‚ã‚Šã¾ã—ãŸã€‚ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã ã‘ã§ãƒ–ãƒ«ãƒ¼ãƒ©ã‚¤ãƒˆã‚‚æµ´ã³ãšã«ã€ã‹ã¤ï¼ˆçœ ã„ä¸­ã§ï¼‰æœ€å°ã®æ‰‹æ•°ã§æ‰“åˆ»ã§ãã‚‹ã®ã¯ã§ãã‚‹ã®ã¯IoTã®ãƒ¡ãƒªãƒƒãƒˆã¨è¨€ãˆã‚‹ã¨æ€ã„ã¾ã™ã€‚


### SORACOM IoT ãƒœã‚¿ãƒ³ã¨ã¯
![soracom_button](/images/products_soracom-lte-button_01.png =200x)

ä»¥ä¸‹ã¯[SORACOM LTE-M Button powered by AWS ](https://soracom.jp/store/5208/)ã‚ˆã‚Šå¼•ç”¨
> SORACOM LTE-M Button powered by AWSã¯ã€3ç¨®é¡žã®ã‚¯ãƒªãƒƒã‚¯ã«å¿œã˜ãŸã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒ©ã‚¦ãƒ‰å´ã§è¨­å®šã§ãã‚‹ã€è‡ªåˆ†ã ã‘ã®IoTãƒœã‚¿ãƒ³ã‚’ä½œã‚Œã‚‹ãƒ‡ãƒã‚¤ã‚¹ã§ã™ã€‚LTE-Mé€šä¿¡ã‚’å†…è”µã—ã€å˜å››é›»æ± ã§é§†å‹•ã—ã¾ã™ã®ã§ã€Wi-Fiç’°å¢ƒã«ä¾å­˜ã›ãšã€å±‹å¤–ã§ã‚‚ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™ã€‚

ã“ã®ãƒœã‚¿ãƒ³ã‚’ä½¿ã†ã“ã¨ã§ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç’°å¢ƒã‚’æ„è­˜ã™ã‚‹ã“ã¨ãªãè‡ªå®…ã¯ã‚‚ã¡ã‚ã‚“ã€å¤–å‡ºå…ˆã§ã‚‚ãƒŸãƒ«ã‚¯ã®é£²ã‚“ã æ™‚åˆ»ã®æ‰“åˆ»ãŒã§ãã‚‹ã¨ã„ã†ä»£ç‰©ã§ã™ã€‚ãªãœSORACOMã®ãƒœã‚¿ãƒ³ã‚’æŽ¡ç”¨ã—ãŸã‹ã«ã¤ã„ã¦ã§ã™ãŒã€æ¥­å‹™ã§AWSã‚’ä½¿ç”¨ã—ã¦ãŠã‚Šã€IoTç³»ã®ã‚µãƒ¼ãƒ“ã‚¹ã¯ã‚ã‚‹ã“ã¨ã¯çŸ¥ã£ã¦ã„ã‚‹ã‘ã©ä½¿ã£ãŸã“ã¨ã¯ãªã„ï¼ˆä½¿ã†æ©Ÿä¼šã‚‚ãªã„ï¼‰ã¨ã„ã†çŠ¶æ³ã ã£ãŸã®ã§ã€å‹‰å¼·ã‚‚å…¼ã­ã¦ä½¿ã£ã¦ã¿ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚
ã¾ãŸã€[SORACOM IoT DIYãƒ¬ã‚·ãƒ”](https://soracom.jp/iot-recipes/)ã¨ã„ã†ãƒŠãƒ¬ãƒƒã‚¸ã‚‚å…¬é–‹ã•ã‚Œã¦ãŠã‚Šã€æ—¢å­˜ã®ãƒ¬ã‚·ãƒ”ã§LINEã¨ã®é€£æºãŒæŽ²è¼‰ã•ã‚Œã¦ã„ãŸã“ã¨ã‚‚ã‚ã£ã¦ã€é–‹ç™ºã®æ•·å±…ãŒä½Žã‹ã£ãŸã¨ã„ã†ç‚¹ã‚‚æŒ™ã’ã‚‰ã‚Œã¾ã™ã€‚

### ä½œã£ã¦ã¿ã‚‹

ã€Œ[SORACOM LTE-M Button powered by AWS ã¨ LINE ã§ä½œã‚‹ã€Œä»Šã‹ã‚‰å¸°ã‚Šã¾ã™ãƒœã‚¿ãƒ³ã€](https://soracom.jp/recipes_index/2964/#LINE_LINE_Notify)ã€é€šã‚Šã«è¨­å®šã‚’é€²ã‚ã¦ã„ãã¾ã—ãŸã€‚ãƒ¬ã‚·ãƒ”ã¯éžå¸¸ã«ã‚ã‹ã‚Šã‚„ã™ãè¨˜è¼‰ã•ã‚Œã¦ãŠã‚Šã€ã‚¹ãƒ ãƒ¼ã‚ºã«æ§‹ç¯‰ã‚’é€²ã‚ã‚‰ã‚Œã¾ã—ãŸã€‚

ãƒ¬ã‚·ãƒ”ã®æ‰‹é †ã§ã¯ã†ã¾ãå‹•ä½œã—ãªãªã‹ã£ãŸç®‡æ‰€ãŒã‚ã£ãŸãŸã‚ã€ãã“ã ã‘ä»¥ä¸‹ã«æŽ²è¼‰ã—ã¾ã™ã€‚
ã€ŒLINE é€šçŸ¥ã‚’åˆ©ç”¨ã™ã‚‹: Lambda é–¢æ•°ã‚’ä½œæˆã™ã‚‹ã€ã®ç®‡æ‰€ã§Lambdaé–¢æ•°ã‚’ä½œæˆã™ã‚‹ã®ã§ã™ãŒã€GitHubã«æŒ™ã’ã‚‰ã‚Œã¦ã„ã‚‹[ã‚³ãƒ¼ãƒ‰](https://raw.githubusercontent.com/j3tm0t0/1-click/master/functions/ifttt/index.js)ã‚’ãã®ã¾ã¾ä½¿ã†ã¨webhookOptionsã®ç®‡æ‰€ã§ã†ã¾ããƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒæ‹¾ãˆãšã€ã‚¨ãƒ©ãƒ¼ã¨ãªã‚Šã¾ã—ãŸã€‚

ä»¥ä¸‹ã«ä¿®æ­£ç‰ˆã®ã‚³ãƒ¼ãƒ‰ã‚’è¨˜è¼‰ã—ã¾ã™ã€‚
```index.js
const https = require('https');
const url = require('url');

const replaceValues = (str, e) => {
  var ret_val = str;
  ret_val = ret_val.replace('$deviceId', e.deviceInfo.deviceId)
  ret_val = ret_val.replace('$remainingLife', e.deviceInfo.remainingLife)
  ret_val = ret_val.replace('$clickType', e.deviceEvent.buttonClicked.clickType)
  ret_val = ret_val.replace('$projectName', e.placementInfo.projectName)
  ret_val = ret_val.replace('$placementName', e.placementInfo.placementName)
  ret_val = ret_val.replace(/\$([\w]+)/g,function(){return e.placementInfo.attributes[RegExp.$1] || "No Attributes named: '"+RegExp.$1 + "' found"})
  return ret_val;
}

exports.handle = function(e, ctx, cb) {
  console.log('processing event: %j', e)
  var key = e.placementInfo.attributes.key
  if(key == null)
  {
    cb("key is not defined.")
  }
  var eventName = e.placementInfo.attributes.event || e.deviceEvent.buttonClicked.clickType
  eventName = replaceValues(eventName, e)
  if(eventName == null)
  {
    cb("coudl not find eventName")
  }
  var webhookUrl = "https://maker.ifttt.com/trigger/"+eventName+"/with/key/"+key
  console.log(webhookUrl)
  var webhookOptions = url.parse(webhookUrl)

  var a = e.placementInfo.attributes
  var values = []
  var data = {}
  for(var i=1 ; i<=3 ; i++)
  {
      values[i] = a["value"+i] || ""
      values[i] = replaceValues(values[i], e)
      data['value'+i] = values[i]
  }
  var body = JSON.stringify(data)
  console.log("sending: "+body+ " to " + webhookUrl)
  webhookOptions = {
    host: "maker.ifttt.com",
    path: "/trigger/"+eventName+"/with/key/"+key,
    method: "POST",
    port: "443",
    headers: {
      'Content-Type':'application/json',
      'Content-Length': Buffer.byteLength(body)
    }
  }
  var req  = https.request (webhookOptions, function(res){
    if (res.statusCode === 200)
    {
      console.log('webhook succeeded')
      cb(null, true)
    }
    else {
      cb("webhook failed with "+res.statusCode)
    }
    return res;
  })
  req.write(body)
  req.end()
}
```

### ã§ããŸã‚‚ã®
SORACOMãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€å¤«å©¦ã®LINEã‚°ãƒ«ãƒ¼ãƒ—ã«ä¸‹å›³ã®ã‚ˆã†ãªé€šçŸ¥ãŒé£›ã¶ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚
![line_iot](/images/line_iot_202303.png =200x) 

### ã‹ã‹ã£ãŸã‚³ã‚¹ãƒˆ
- åˆæœŸè²»ç”¨ï¼š 8,778 å††ã€€(SORACOM LTE-M Button powered by AWSè²»ç”¨ã€‚ãƒœã‚¿ãƒ³ä»£)
- ãƒ©ãƒ³ãƒ‹ãƒ³ã‚°ã‚³ã‚¹ãƒˆï¼šã€€ç´„38å††ï¼æœˆï¼ˆAWS IoT 1 Clickä»£ï¼‰  
ã€€â€»SORACOM LTE-M Buttonã®æ›´æ–°æ‰‹æ•°æ–™ãŒ 1,320å††ã‹ã‹ã‚‹ï¼ˆ1å¹´åˆ©ç”¨ or 1,500å›žã‚¯ãƒªãƒƒã‚¯ï¼‰

## ã¾ã¨ã‚ï¼†ä»Šå¾Œã®èª²é¡Œ
åˆæœŸå°Žå…¥è²»ç”¨ã‚„AWSã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ç”¨æ„ã—ã¦ãŠã‹ãªã‘ã‚Œã°ãªã‚‰ãªã„ãªã©ã€æœ€åˆã®å°Žå…¥éƒ¨åˆ†ã«å°‘ã—ãƒãƒ¼ãƒ‰ãƒ«ã‚’æ„Ÿã˜ã‚‹æ–¹ã‚‚ã„ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€2ã€œ3æ™‚é–“ã¡ã‚‡ã£ã¨ï¼ˆâ€»ã‚¨ãƒ©ãƒ¼è§£æžç­‰é™¤ãï¼‰ã§ãªã‚“ã¡ã‚ƒã£ã¦æ‰“åˆ»ã‚·ã‚¹ãƒ†ãƒ ãŒå€‹äººã§ä½œã‚Œã¾ã—ãŸã€‚
ãƒŸãƒ«ã‚¯ã‚’é£²ã¾ã›ãŸå¾Œãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã®ã‚’å¿˜ã‚Œã‚‹ã€ã¨ã„ã£ãŸæœ¬æœ«è»¢å€’ãªã“ã¨ã‚‚ãŸã¾ã«ã‚ã‚Šã¾ã™ãŒã€ã€Œä»Šæ—¥ã¯ã‚ã¾ã‚ŠãƒŸãƒ«ã‚¯é£²ã¾ãªã„ã­ã€ã‚¦ãƒ³ãƒãŒæºœã¾ã£ã¦ã‚‹ã®ã‹ãªã€ç­‰ã€å­ã©ã‚‚ã®ä½“èª¿ã‚’æŽ¨æ¸¬ã™ã‚‹ã“ã¨ã«ã‚‚ä½¿ã£ã¦ã„ãŸã‚Šã—ã¾ã™ã€‚

ä»Šå›ž1å›žãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã“ã¨ã§ãƒŸãƒ«ã‚¯é£²ã‚“ã ã‚ˆé€šçŸ¥ã™ã‚‹ä»•çµ„ã¿ã‚’ä½œã‚Šã¾ã—ãŸãŒã€2å›žé€£ç¶šã§æŠ¼ä¸‹ã—ãŸå ´åˆã‚„é•·æ™‚é–“æŠ¼ä¸‹ã—ãŸå ´åˆã®æŒ™å‹•ã‚‚è¨­å®šã§ãã‚‹ãŸã‚ã€ä¾‹ãˆã°2å›žé€£ç¶šã§æŠ¼ã—ãŸã‚‰ã‚¦ãƒ³ãƒã—ãŸã“ã¨ã‚’é€šçŸ¥ã™ã‚‹ã€ã¨ã„ã£ãŸä»•çµ„ã¿ã‚‚ä½œã‚Œã‚‹ã‹ã¨æ€ã£ã¦ã„ã¾ã™ã€‚

ã¾ãŸã€ä»Šå¾Œå­ã©ã‚‚ãŒå¤§ãããªã£ã¦ã„ãã€å­¦æ ¡ã‚„å¡¾ç­‰ã®ç¿’ã„äº‹ã§è¿Žãˆã«ãã¦ã»ã—ã„ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã‚‚ã‚‰ã£ã¦ã€è¦ªã«é€£çµ¡ã™ã‚‹ã¨ã„ã£ãŸä»Šå¾Œã®ãƒœã‚¿ãƒ³ã®æ´»ç”¨æ³•ã‚‚ã‚ã‚‹ã¨æ€ã£ã¦ã„ã¾ã™ã€‚æ—¥æ›œå¤§å·¥ã¿ãŸã„ãªãƒŽãƒªã§ã€ã“ã†ã„ã£ãŸIoTãƒ‡ãƒã‚¤ã‚¹ã‚’ã†ã¾ãæ—¥å¸¸ã«æ´»ç”¨ã—ã¦ã„ããŸã„ãªã¨æ€ã„ã¾ã—ãŸã€‚

## å‚è€ƒ
- [SORACOM LTE-M Button powered by AWS ](https://soracom.jp/store/5208/)ã€€
- [SORACOM IoT ãƒ¬ã‚·ãƒ”ï¼šIoTã§å‘¼ã³å‡ºã—ã‚·ã‚¹ãƒ†ãƒ ](https://soracom.jp/recipes_index/2964/#LINE_LINE_Notify)